(this["webpackJsonpchat-app"]=this["webpackJsonpchat-app"]||[]).push([[0],{115:function(e,t,n){e.exports=n(174)},124:function(e,t,n){},126:function(e,t,n){},148:function(e,t,n){},149:function(e,t,n){},150:function(e,t,n){},152:function(e,t,n){},153:function(e,t,n){},154:function(e,t,n){},155:function(e,t,n){},156:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){},171:function(e,t,n){},174:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(41),s=n.n(o),c=n(23),i=n(65),l=n(107),u=(n(124),n(7)),d=Object.freeze({PROCESS_ACTION:"PROCESS_ACTION",PROCESS_ACTION_FAILED:"PROCESS_ACTION_FAILED",UPDATE_TOKEN:"UPDATE_TOKEN",PROCESS_MESSAGE_ACTION:"PROCESS_MESSAGE_ACTION",PROCESS_MESSAGE_ACTION_FAILED:"PROCESS_MESSAGE_ACTION_FAILED",CONVERSATIONS_LOADED:"CONVERSATIONS_LOADED",MESSAGES_REQUESTED:"MESSAGES_REQUESTED",NEW_MESSAGE_ADDED:"NEW_MESSAGE_ADDED",CHANGE_LAST_MESSAGE:"CHANGE_LAST_MESSAGE"}),m={conversations:[],selectedConversation:{}};m.selectedConversation=m.conversations[1];var p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CONVERSATIONS_LOADED":return Object(u.a)(Object(u.a)({},e),{},{conversations:t.payload.conversations?t.payload.conversations:[]});case"SELECTED_CONVERSATION_CHANGED":var n=e.conversations.find((function(e){return e._id===t.conversationId}));return Object(u.a)(Object(u.a)({},e),{},{selectedConversation:n});case"DELETE_CONVERSATION":if(e.selectedConversation){var a=Object(u.a)({},e),r=a.conversations.findIndex((function(e){return e._id===a.selectedConversation._id}));return a.conversations.splice(r,1),a.conversations.length>0?(r>0&&--r,a.selectedConversation=a.conversations[r]):a.selectedConversation=null,a}return e;case d.CHANGE_LAST_MESSAGE:var o=e.conversations.find((function(e){return e._id.toString()===t.data.id}));return o.latestMessageText=t.data.newMessage,e.selectedConversation.latestMessageText=t.data.newMessage,Object(u.a)({},e);default:return e}},f={isLoading:!1,messageDetails:[]},E=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case d.PROCESS_MESSAGE_ACTION:return Object(u.a)(Object(u.a)({},e),{},{isLoading:!0});case d.MESSAGES_REQUESTED:return Object(u.a)(Object(u.a)({},e),{},{messageDetails:t.payload,isLoading:!1});case d.NEW_MESSAGE_ADDED:case d.PROCESS_MESSAGE_ACTION_FAILED:return Object(u.a)(Object(u.a)({},e),{},{isLoading:!1});default:return e}},g={isUserLoggedIn:!!window.localStorage.getItem("isUserLoggedIn"),email:window.localStorage.getItem("email")||"",fullName:window.localStorage.getItem("fullName")||"",token:window.localStorage.getItem("token")||"",userId:window.localStorage.getItem("userId")||"",lastActiveAt:window.localStorage.getItem("lastActiveAt")||"",userRole:window.localStorage.getItem("userRole")||""},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN_SUCCESS":return t.data?(window.localStorage.setItem("isUserLoggedIn",!0),window.localStorage.setItem("email",t.data.email),window.localStorage.setItem("fullName",t.data.fullName),window.localStorage.setItem("token",t.data.token),window.localStorage.setItem("userId",t.data.userId),window.localStorage.setItem("lastActiveAt",t.data.lastActiveAt),window.localStorage.setItem("userRole",t.data.userRole),Object(u.a)(Object(u.a)({},e),{},{email:t.data.email||"",token:t.data.token||"",isUserLoggedIn:!0,fullName:t.data.fullName||"",lastActiveAt:t.data.lastActiveAt||"",userId:t.data.userId||"",userRole:t.data.userRole||""})):{};case d.UPDATE_TOKEN:return window.localStorage.setItem("token",t.token),Object(u.a)(Object(u.a)({},e),{},{token:t.token});case"USER_RESET":return window.localStorage.clear(),Object(u.a)(Object(u.a)({},e),{},{isUserLoggedIn:!1,email:"",token:"",fullName:"",lastActiveAt:"",userId:"",userRole:""});default:return e}},h=Object(i.b)({conversationState:p,messagesState:E,userState:v}),k=n(67),b=n(18);function S(){return r.a.createElement("div",{style:{width:100,height:100,backgroundColor:"#000"}},"Forget")}var O=n(9),w=n.n(O),x=n(16),C=n(6),j=n(13),I=(n(126),n(205)),A=n(206),y=n(203),N=n(204),M=n(210),L=n(209),_=n(196),R=n(197),D=n(99),T=n.n(D).a.create({baseURL:"https://daisycare-support.herokuapp.com"});T.interceptors.response.use((function(e){return e.data}));var G=T,P=function(e){return G.delete("/sign-out",{data:{userId:e}})},F=function(e){return function(t){t({type:"LOGIN_SUCCESS",data:{email:e.user.email,token:e.token,fullName:e.user.fullName,lastActiveAt:e.user.lastActiveAt,userId:e.user._id,userRole:e.user.userRole}})}};function W(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],o=t[1],s=Object(a.useState)({email:"",password:""}),i=Object(j.a)(s,2),l=i[0],d=i[1],m=Object(c.c)(),p=Object(a.useState)({errEmail:"",errPassword:""}),f=Object(j.a)(p,2),E=f[0],g=f[1],v=function(e){return function(t){d(Object(u.a)(Object(u.a)({},l),{},Object(C.a)({},e,t.target.value)))}},h=function(){var e=Object(x.a)(w.a.mark((function e(){var t;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g({errEmail:"",errPassword:""}),l.email?!!l.password||(g(Object(u.a)(Object(u.a)({},E),{},{errPassword:"Password is not valid!"})),!1):(g(Object(u.a)(Object(u.a)({},E),{},{errEmail:"Email is not valid!"})),!1)){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,n={email:l.email,password:l.password},G.post("/sign-in",n);case 8:(t=e.sent)&&0===t.errCode?m(F(t.data)):(2===t.errCode&&g({errPassword:"",errEmail:t.errMessage}),3===t.errCode&&g({errMessage:"",errPassword:t.errMessage}));case 10:case"end":return e.stop()}var n}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(e){13===e.keyCode&&h()};return r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"bg"}),r.a.createElement("div",{className:"bg2"}),r.a.createElement("div",{className:"content-left"}),r.a.createElement("div",{className:"content-right"},r.a.createElement("h3",{className:"title"},"Login"),r.a.createElement("div",{className:"form-group"},r.a.createElement(I.a,{className:"form-control",sx:{m:1,width:"100%"},variant:"outlined"},r.a.createElement(A.a,{htmlFor:"outlined-adornment-password"},"Your email"),r.a.createElement(y.a,{className:"placholder",id:"outlined-adornment-password",value:l.email,onChange:v("email"),label:"Yourasdasdsadsdaa",onKeyDown:b})),r.a.createElement("label",{className:"err"},E.errEmail),r.a.createElement(I.a,{className:"form-control",sx:{m:1,width:"100%"},variant:"outlined"},r.a.createElement(A.a,{htmlFor:"outlined-adornment-password"},"Your password"),r.a.createElement(y.a,{className:"placholder",id:"outlined-adornment-password",type:n?"text":"password",value:l.password,onChange:v("password"),label:"TypefdgfgfgYour password",onKeyDown:b,endAdornment:r.a.createElement(N.a,{position:"end"},r.a.createElement(M.a,{"aria-label":"toggle password visibility",onClick:function(){o((function(e){return!e}))},onMouseDown:function(e){e.preventDefault()},edge:"end"},n?r.a.createElement(_.a,null):r.a.createElement(R.a,null)))})),r.a.createElement("label",{className:"err"},E.errPassword),r.a.createElement("p",{className:"hint"},"*  Use Daisy Care account"),r.a.createElement(L.a,{className:"button",variant:"contained",onClick:function(){return h()},style:{backgroundColor:"#000333"}},"Sign in"),r.a.createElement("p",{className:"mobile"},"Try on mobile?"),r.a.createElement("div",{className:"other-media"},r.a.createElement("div",{className:"android-app"}),r.a.createElement("div",{className:"ios-app"})),r.a.createElement("div",{className:"forget"},r.a.createElement(k.b,{to:"/forgot-password"},"Forgot your password")))))}var U=function(e,t){return G.get("/api/get-all-channel-online?userId=".concat(e),{headers:{Authorization:"Bearer ".concat(t)}}).catch((function(e){return e.response&&e.response.status}))},z=function(e,t){return G.get("/api/get-all-user-inbox?adminId=".concat(e),{headers:{Authorization:"Bearer ".concat(t)}}).catch((function(e){return e.response&&e.response.status}))},B=function(e,t){return G.post("/api/get-detail-inbox",e,{headers:{Authorization:"Bearer ".concat(t)}}).catch((function(e){return e.response&&e.response.status}))},H=function(e){return G.post("/api/send-message",e,{headers:{Authorization:"Bearer ".concat(e.token)}}).catch((function(e){return e.response&&e.response.status}))},K=n(58),V=function(){var e=Object(x.a)(w.a.mark((function e(t,n){var a,r,o,s,c,i,l,u;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.conversationId,r=t.token,o=t.role,s=t.userId,c=t.skip,i={skip:c,limit:10,id:a,role:o},e.next=4,B(i,r);case 4:if(!(l=e.sent)){e.next=18;break}if(401!==l){e.next=13;break}return e.next=9,Y(s,r);case 9:(u=e.sent)?(K.b.error("Request out of time. Let try again!"),n({type:d.UPDATE_TOKEN,token:u})):q(),e.next=18;break;case 13:if(403!==l){e.next=17;break}q(),e.next=18;break;case 17:return e.abrupt("return",0===l.errCode?l.data.messages:[]);case 18:return e.abrupt("return",[]);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Y=function(){var e=Object(x.a)(w.a.mark((function e(t,n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r={userId:t,token:n},G.post("/refresh-token",r,{headers:{Authorization:"Bearer ".concat(r.token)}}).catch((function(e){return e.response&&e.response.status}));case 2:if(!(a=e.sent)||!a.token){e.next=7;break}return e.abrupt("return",a.token);case 7:return q(),e.abrupt("return",null);case 9:case"end":return e.stop()}var r}),e)})));return function(t,n){return e.apply(this,arguments)}}(),q=function(){window.localStorage.clear(),window.location.href="/login"},Q=(n(148),function(e){var t=e.conversations,n=Object(a.useState)(""),o=Object(j.a)(n,2);o[0],o[1];return r.a.createElement("div",{id:"search-container"},t&&t.length>0&&r.a.createElement("input",{type:"text",placeholder:"Search"}))}),J=(n(90),function(e){var t=e.children;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"primary-button"},t))}),X=(n(149),function(){return r.a.createElement("div",{id:"no-coversation-layout"},r.a.createElement("div",{id:"no-conversation-content"},r.a.createElement("h2",null,"No Admin Online Now"),r.a.createElement("p",null,"Currently, We work from 8:00 a.m to 9:00 p.m."),r.a.createElement("p",null,"Sorry for making you have to wait!."),r.a.createElement("p",null,"If you want to receive notification when Channel is on. Click the button bellow!"),r.a.createElement(J,null,"Notify Me")))}),Z=n(19),$=n.n(Z),ee=(n(150),"https://bizweb.dktcdn.net/100/173/931/themes/233699/assets/sp3.jpg?1610425866100"),te="https://www.kindpng.com/picc/m/105-1055656_account-user-profile-avatar-avatar-user-profile-icon.png",ne=n(68),ae=n.n(ne),re=function(e){var t=e.conversation,n=e.isActive,a=e.onConversationItemSelected,o=$()("conversation",{selected:n}),s=Object(c.d)((function(e){return e.userState})),i=s.userRole,l=s.token,u=s.userId,d=function(){var e=Object(x.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a({conversationId:t._id,token:l,role:i,userId:u});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:o,onClick:d},r.a.createElement("img",{src:"R2"===i?ee:te,alt:"imageAlt"}),r.a.createElement("div",{className:"title-text"},t.userId.fullName||t.adminId.fullName),r.a.createElement("div",{className:"created-date"},ae()(t&&t.adminId&&t.adminId.createdAt).startOf("hour").fromNow()),r.a.createElement("div",{className:"conversation-message"},t.latestMessageText?t.latestMessageText:"Chat now"))},oe=(n(152),function(e){var t=e.conversations,n=e.selectedConversation,a=e.onConversationItemSelected,o=t.map((function(e){var t=n&&e._id===n._id;return r.a.createElement(re,{key:e._id,onConversationItemSelected:a,isActive:t,conversation:e})}));return r.a.createElement("div",{id:"conversation-list"},o)}),se=(n(153),function(e){var t=e.onLogout,n=Object(c.d)((function(e){return e.userState})).userId;return r.a.createElement("div",{id:"new-message-container"},r.a.createElement("button",{onClick:function(){return t(n)}},r.a.createElement("img",{src:"https://img.icons8.com/flat-round/64/000000/shutdown--v1.png",alt:"Logout"})))}),ce=(n(154),function(){return r.a.createElement("svg",{className:"trash-logo",enableBackground:"new 0 0 500 500",version:"1.1",viewBox:"0 0 500 500",xmlSpace:"preserve",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.a.createElement("g",null,r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"101.642",x2:"120.633",y1:"134.309",y2:"430.972"}),r.a.createElement("path",{d:"   M120.633,430.972c0,10.5,8.519,19.031,18.992,19.031",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"139.625",x2:"360.389",y1:"450.003",y2:"450.003"}),r.a.createElement("path",{d:"   M360.389,450.003c10.474,0,18.979-8.531,18.979-19.031",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("polyline",{fill:"none",points:"   379.367,430.972 398.386,134.309 101.642,134.309  ",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("path",{d:"   M432.779,115.973c0,10.059-8.143,18.215-18.188,18.215",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"414.592",x2:"85.409",y1:"134.188",y2:"134.188"}),r.a.createElement("path",{d:"   M85.409,134.188c-10.018,0-18.188-8.156-18.188-18.215",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("path",{d:"   M67.221,115.973c0-10.019,8.17-18.188,18.188-18.188",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"85.409",x2:"414.592",y1:"97.784",y2:"97.784"}),r.a.createElement("path",{d:"   M414.592,97.784c10.045,0,18.188,8.17,18.188,18.188",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"307.364",x2:"307.364",y1:"97.49",y2:"68.988"}),r.a.createElement("path",{d:"   M307.364,68.988c0-10.474-8.505-18.991-18.965-18.991",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"288.399",x2:"211.628",y1:"49.997",y2:"49.997"}),r.a.createElement("path",{d:"   M211.628,49.997c-10.487,0-18.979,8.518-18.979,18.991",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"}),r.a.createElement("polyline",{fill:"none",points:"   192.649,68.988 192.649,97.49 307.364,97.49  ",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10"})),r.a.createElement("g",null,r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"166.332",x2:"166.332",y1:"172.278",y2:"406.06"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"222.102",x2:"222.102",y1:"172.278",y2:"406.06"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"277.926",x2:"277.926",y1:"172.278",y2:"406.06"}),r.a.createElement("line",{fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"2.6131",strokeWidth:"10",x1:"333.669",x2:"333.669",y1:"172.278",y2:"406.06"})))}),ie=(n(155),function(e){var t=e.selectedConversation,n=e.onDeleteConversation;return r.a.createElement("div",{id:"chat-title"},t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,t.adminId.fullName),r.a.createElement("div",{onClick:function(){return n()},title:"Delete Conversation"},r.a.createElement(ce,null))))}),le=n(27),ue=(n(156),function(e){var t=e.isMyMessage,n=e.message,a=$()("message-row",{"you-message":t,"other-message":!t}),o=Object(c.d)((function(e){return e.userState})).userRole,s=t?null:r.a.createElement("img",{src:"R2"===o?ee:te,alt:"imageAlt"});return r.a.createElement("div",{className:a},r.a.createElement("div",{className:"message-content"},s,r.a.createElement("div",{className:"message-text"},n.image?r.a.createElement("img",{src:n.image,className:"w-100"}):n.text),r.a.createElement("div",{className:"message-time"},ae()(n.createdAt).startOf("second").fromNow())))}),de=(n(157),function(e){var t=e.children,n=e.disabled;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{type:"submit",className:"primary-button",disabled:n},t))}),me=(n(158),function(e){var t=e.handleChooseFile,n=e.inputFileRef;return r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{ref:n,type:"file",id:"file",hidden:!0,onChange:t}),r.a.createElement("label",{htmlFor:"file"},r.a.createElement("svg",{version:"1.1",className:"attachment-logo",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512.001 512.001",xmlSpace:"preserve"},r.a.createElement("path",{d:"M475.753,61.289c-48.329-48.329-126.967-48.329-175.296,0L15.535,346.212\r c-20.713,20.713-20.713,54.413,0,75.127l50.085,50.085c20.713,20.713,54.413,20.713,75.127,0l221.305-221.305\r c20.713-20.713,20.713-54.413,0-75.127s-54.413-20.713-75.127,0L168.981,292.935c-6.915,6.915-6.915,18.127,0,25.042\r c6.915,6.915,18.127,6.915,25.042,0l117.943-117.943c6.903-6.903,18.137-6.906,25.042,0c6.906,6.906,6.903,18.14,0,25.042\r L115.705,446.38c-6.903,6.903-18.137,6.906-25.042,0l-50.085-50.085c-6.906-6.906-6.903-18.14,0-25.042L325.499,86.332\r c34.519-34.519,90.689-34.522,125.211,0s34.519,90.693,0,125.211l-181.56,181.56c-6.915,6.915-6.915,18.127,0,25.042\r c6.915,6.915,18.127,6.915,25.042,0l181.56-181.56C524.083,188.256,524.083,109.62,475.753,61.289z"}),r.a.createElement("g",null,r.a.createElement("path",{d:"M299.446,187.512L181.503,305.456c-4.623,4.623-6.081,11.149-4.523,17.045\r c-2.924-0.772-5.705-2.231-7.997-4.523c-6.915-6.915-6.915-18.127,0-25.042l117.943-117.943c20.713-20.713,54.413-20.713,75.127,0\r c2.137,2.137,3.999,4.44,5.695,6.826C347.015,167.074,318.022,168.936,299.446,187.512z"}),r.a.createElement("path",{d:"M456.654,92.911c2.265,1.855,4.465,3.83,6.578,5.943c34.522,34.522,34.519,90.693,0,125.211\r l-181.56,181.56c-4.623,4.623-6.081,11.149-4.523,17.045c-2.924-0.772-5.705-2.231-7.997-4.523c-6.915-6.915-6.915-18.127,0-25.042\r l181.56-181.56C483.117,179.138,485.094,127.655,456.654,92.911z"}),r.a.createElement("path",{d:"M115.705,446.38l221.305-221.305c4.613-4.613,6.07-11.142,4.519-17.04\r c2.927,0.77,5.712,2.228,8.003,4.519c6.906,6.906,6.903,18.14,0,25.042L128.226,458.902c-6.903,6.903-18.137,6.906-25.042,0\r L90.663,446.38C97.568,453.286,108.802,453.283,115.705,446.38z"}),r.a.createElement("path",{d:"M312.978,73.811L28.057,358.732c-20.713,20.713-20.713,54.413,0,75.127l-12.521-12.521\r c-20.713-20.713-20.713-54.413,0-75.127L300.457,61.289c48.329-48.329,126.967-48.329,175.296,0\r c2.113,2.113,4.015,4.354,5.943,6.577C433.056,25.693,359.195,27.594,312.978,73.811z"})))))}),pe=n(108);n(106);function fe(e){return new Promise((function(t,n){var a=new FileReader;a.readAsDataURL(e),a.onload=function(){return t(a.result)},a.onerror=n}))}var Ee,ge=function(e){return 0===ve(e).length},ve=function(e){return e.trim()},he=Object(c.b)((function(e){return{userId:e.userState.userId,userRole:e.userState.userRole,token:e.userState.token,userName:e.userState.fullName}}),(function(e){return{onMessageSubmitted:function(t){return e(function(e){return function(){var t=Object(x.a)(w.a.mark((function t(n){var a,r;return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:d.PROCESS_MESSAGE_ACTION}),t.next=3,H(e);case 3:if(!(a=t.sent)){t.next=15;break}if(401!==a){t.next=12;break}return t.next=8,Y(e.userId,e.token);case 8:(r=t.sent)?(K.b.error("Request out of time. Let try again!"),n({type:d.UPDATE_TOKEN,token:r})):q(),t.next=13;break;case 12:403===a?q():n({type:d.NEW_MESSAGE_ADDED});case 13:t.next=16;break;case 15:n({type:d.PROCESS_MESSAGE_ACTION_FAILED});case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t))}}}))((function(e){var t=e.conversationId,n=e.onMessageSubmitted,o=e.adminId,s=e.userId,i=e.userRole,l=e.userName,d=e.token,m=e.handleChangeLastMessage,p=e.callOtherSideChange,f=Object(a.useState)({allMessages:[],textMessage:"",skip:0}),E=Object(j.a)(f,2),g=E[0],v=E[1],h=Object(a.useRef)(),k=g.allMessages,b=g.textMessage,S=g.skip,O=Object(c.c)(),I=ge(b),A=function(){var e=Object(x.a)(w.a.mark((function e(n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({conversationId:t,token:d,role:i,userId:s,skip:n},O);case 2:(a=e.sent)&&a.length>0?v((function(e){return Object(u.a)(Object(u.a)({},e),{},{textMessage:"",file:null,allMessages:a})})):v(Object(u.a)(Object(u.a)({},g),{},{allMessages:[]}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=Object(x.a)(w.a.mark((function e(n){var a;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V({conversationId:t,token:d,role:i,userId:s,skip:n},O);case 2:(a=e.sent)&&a.length>0&&v((function(e){return Object(u.a)(Object(u.a)({},e),{},{textMessage:"",file:null,allMessages:[].concat(Object(le.a)(g.allMessages),Object(le.a)(a))})}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){A(0)}),[]),Object(a.useEffect)((function(){t&&A(0)}),[t]),Object(a.useEffect)((function(){return(Ee=Object(pe.a)("https://daisycare-support.herokuapp.com")).emit("join",{userId:s,userName:l,roomId:t},function(){var e=Object(x.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("connect error");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),function(){Ee.disconnect(),Ee.off()}}),[Ee]),Object(a.useEffect)((function(){Ee.on("receiveMessage",function(){var e=Object(x.a)(w.a.mark((function e(n){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:v(Object(u.a)(Object(u.a)({},g),{},{allMessages:[Object(u.a)({},n)].concat(Object(le.a)(g.allMessages))})),m({newMessage:n.image?"File":n.text,id:t});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[Ee]);var N=function(){var e=Object(x.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),o&&s){e.next=3;break}return e.abrupt("return");case 3:if(ge(b)){e.next=7;break}return n={_id:Math.random(),text:b,createdAt:(new Date).toISOString(),isRead:!1,image:null,senderId:s},e.next=7,M(n);case 7:case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function M(e){return L.apply(this,arguments)}function L(){return(L=Object(x.a)(w.a.mark((function e(a){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ee.emit("sendMessage",{roomId:t,dataMessage:a},function(){var e=Object(x.a)(w.a.mark((function e(r){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n({_id:t,text:b,senderId:s,userId:s,createdAt:new Date,token:d,adminId:o._id,image:a.image});case 2:r===s&&(v(Object(u.a)(Object(u.a)({},g),{},{allMessages:[Object(u.a)({},a)].concat(Object(le.a)(g.allMessages)),textMessage:""})),m({newMessage:b||"File",id:t}),p());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=function(){var e=Object(x.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o&&s){e.next=2;break}return e.abrupt("return");case 2:fe(t.target.files[0]).then(function(){var e=Object(x.a)(w.a.mark((function e(t){var n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=5;break}return n={_id:Math.random(),text:null,createdAt:(new Date).toISOString(),isRead:!1,image:t,senderId:s},h.current.value="",e.next=5,M(n);case 5:case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function R(){return(R=Object(x.a)(w.a.mark((function e(t){var n,a,r,o,s;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.currentTarget,a=n.scrollTop,r=n.scrollHeight,o=n.clientHeight,Math.ceil(-a+o)!==r){e.next=6;break}return s=S+10,v(Object(u.a)(Object(u.a)({},g),{},{skip:s})),e.next=6,y(s);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{onScroll:function(e){return R.apply(this,arguments)},id:"chat-message-list"},k.length>0?k.map((function(e,t){return r.a.createElement(ue,{key:t,isMyMessage:e.senderId===s,message:e})})):r.a.createElement(r.a.Fragment,null)),r.a.createElement("form",{id:"chat-form",onSubmit:N},r.a.createElement("div",{title:"Add Attachment"},r.a.createElement(me,{handleChooseFile:_,inputFileRef:h})),r.a.createElement("input",{type:"text",placeholder:"type a message",value:b,name:"textMessage",onChange:function(e){var t=e.target,n=t.value,a=t.name;v((function(e){return Object(u.a)(Object(u.a)({},e),{},Object(C.a)({},a,n))}))}}),r.a.createElement(de,{disabled:I},"Send")))})),ke=n(208),be=n(198),Se=n(199),Oe=n(200),we=n(201),xe=function(e){var t=e.toggle,n=e.modal;return r.a.createElement(ke.a,{isOpen:n,toggle:t,style:{zIndex:100}},r.a.createElement(be.a,{toggle:t},"Welcome to Daisy Care Support page!"),r.a.createElement(Se.a,null,r.a.createElement("h3",null,"Currently, We work from 8:00 a.m to 9:00 p.m."),r.a.createElement("h5",null,"Channel 1: Ask about common problems."),r.a.createElement("h5",null,"Channel 2: Support you booking schedule/ change schedule."),r.a.createElement("h5",null,"Channel 3: Ask/Complain about our service."),r.a.createElement("h6",null,"Have a good day!")),r.a.createElement(Oe.a,null,r.a.createElement(we.a,{color:"primary",onClick:t},"I got it")))},Ce=(n(171),Object(c.b)((function(e){return{conversations:e.conversationState.conversations,selectedConversation:e.conversationState.selectedConversation,userRole:e.userState.userRole,token:e.userState.token,userId:e.userState.userId}}),(function(e){return{conversationChanged:function(t){return e(function(e){return function(){var t=Object(x.a)(w.a.mark((function t(n){return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n({type:"SELECTED_CONVERSATION_CHANGED",conversationId:e.conversationId});case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t))},onDeleteConversation:function(){return e({type:"DELETE_CONVERSATION"})},loadConversations:function(t,n,a){return e(function(e,t,n){return function(){var a=Object(x.a)(w.a.mark((function a(r){var o,s;return w.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(r({type:d.PROCESS_MESSAGE_ACTION}),o={},"R2"!==t){a.next=8;break}return a.next=5,U(e,n);case 5:o=a.sent,a.next=11;break;case 8:return a.next=10,z(e,n);case 10:o=a.sent;case 11:if(!o){a.next=22;break}if(401!==o){a.next=19;break}return a.next=15,Y(e,n);case 15:(s=a.sent)?(K.b.error("Request out of time. Let try again!"),r({type:d.UPDATE_TOKEN,token:s})):q(),a.next=20;break;case 19:403===o?q():r({type:d.CONVERSATIONS_LOADED,payload:{conversations:o.data&&o.data}});case 20:a.next=23;break;case 22:r({type:d.PROCESS_MESSAGE_ACTION_FAILED});case 23:case"end":return a.stop()}}),a)})));return function(e){return a.apply(this,arguments)}}()}(t,n,a))},onLogout:function(t){return e(function(e){return function(){var t=Object(x.a)(w.a.mark((function t(n){return w.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n({type:"USER_RESET"}),t.next=3,P(e);case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}(t))},handleChangeLastMessage:function(t){return e(function(e){return{type:d.CHANGE_LAST_MESSAGE,data:e}}(t))}}}))((function(e){var t=e.conversations,n=e.selectedConversation,o=e.conversationChanged,s=e.onDeleteConversation,c=e.loadConversations,i=e.onLogout,l=e.userRole,u=e.userId,d=e.token,m=e.handleChangeLastMessage;Object(a.useEffect)((function(){c(u,l,d)}),[]);var p=Object(a.useState)("R2"===l),f=Object(j.a)(p,2),E=f[0],g=f[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"chat-container"},r.a.createElement(Q,{conversations:t}),r.a.createElement(oe,{onConversationItemSelected:o,conversations:t,selectedConversation:n}),r.a.createElement(se,{onLogout:i}),r.a.createElement(ie,{selectedConversation:n,onDeleteConversation:s}),t.length>0?r.a.createElement(he,{conversationId:n&&n._id||"",adminId:n&&n.adminId||"",handleChangeLastMessage:m,callOtherSideChange:function(){c(u,l,d)}}):r.a.createElement(X,null)),r.a.createElement(xe,{toggle:function(){return g(!E)},modal:E}))}))),je=(n(172),n(173),function(){var e=Object(c.d)((function(e){return e.userState})).isUserLoggedIn;return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,null,r.a.createElement(b.d,null,r.a.createElement(b.b,{exact:!0,path:"/",component:Ce}),r.a.createElement(b.b,{exact:!0,path:"/login",component:W}),r.a.createElement(b.b,{exact:!0,path:"forgot-password",component:S})),r.a.createElement(b.a,{to:e?"/":"/login"})),r.a.createElement(K.a,{position:"top-right",autoClose:2e3,hideProgressBar:!1,newestOnTop:!1,closeOnClick:!0,rtl:!1,pauseOnFocusLoss:!0,draggable:!0,pauseOnHover:!0,theme:"dark"}))}),Ie=[l.a],Ae=Object(i.c)(h,i.a.apply(void 0,Ie));s.a.render(r.a.createElement(c.a,{store:Ae},r.a.createElement(je,null)),document.getElementById("root"))},90:function(e,t,n){}},[[115,1,2]]]);
//# sourceMappingURL=main.e96547a0.chunk.js.map